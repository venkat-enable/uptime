<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Status Page</title>
  <link href="styles.css" rel="stylesheet">
</head>
<body>
  <header>
    <h1>Environment Status</h1>
  </header>
  <nav>
    <ul>
      <li><a href="#prod">Prod</a></li>
      <li><a href="#preprod">Preprod</a></li>
    </ul>
  </nav>

  <!-- Prod Section -->
  <section id="prod">
    <h2>Prod Services</h2>
    <ul class="service-list">
      <!-- Services will be dynamically added here -->
    </ul>
  </section>

  <!-- Preprod Section -->
  <section id="preprod">
    <h2>Preprod Services</h2>
    <ul class="service-list">
      <!-- Services will be dynamically added here -->
    </ul>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', async function () {
      // Example service data with URLs
      const serviceData = {
        prod: [
          { name: "sub Service", url: "https://enable-trial01.enable-technologies.app/api/subscription/diagnostics/ping", status: "Fetching..." },
          { name: "Party", url: "https://enable-trial01.enable-technologies.app/api/party/diagnostics/ping", status: "Fetching..." },
          { name: "origination", url: "https://enable-trial01.enable-technologies.app/api/origination/diagnostics/ping", status: "Fetching..." }
        ],
        preprod: [
          { name: "sub Service", url: "https://enable-dev01.enable-technologies.app/api/subscription/diagnostics/ping", status: "Fetching..." },
          { name: "Party", url: "https://enable-dev01.enable-technologies.app/api/party/diagnostics/ping", status: "Fetching..." },
          { name: "origination", url: "https://enable-dev01.enable-technologies.app/api/origination/diagnostics/ping", status: "Fetching..." }
        ]
      };

      // Fetch live status from URLs
      async function fetchServiceStatus(url) {
        try {
          const response = await fetch(url, { method: 'GET' });
          if (response.ok) {
            return "Operational"; // Update based on API response if necessary
          } else {
            return "Degraded";
          }
        } catch (error) {
          return "Outage";
        }
      }

      // Populate services dynamically
      async function populateServices(env, data) {
        const section = document.querySelector(`#${env} .service-list`);
        for (const service of data) {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${service.name}:</strong> ${service.status}`;
          section.appendChild(li);

          // Update status dynamically
          const status = await fetchServiceStatus(service.url);
          li.innerHTML = `<strong>${service.name}:</strong> ${status}`;
        }
      }

      // Populate Prod Services
      await populateServices("prod", serviceData.prod);

      // Populate Preprod Services
      await populateServices("preprod", serviceData.preprod);
    });
  </script>
</body>
</html>
